<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Pedidos Bonitos ✨</title>

    <link rel="icon" href="/favicon.png" type="image/png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Nunito+Sans:wght@400;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Flatpickr CSS for Date Picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    
    <!-- Flatpickr JS for Date Picker -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/es.js"></script>

    <!-- 
      FIX: Corrected the path to the CSS file.
      The original path "estilos.css" was incorrect because the file is inside the "estilos" directory.
      The path has been changed to "estilos/estilos.css".
    -->
    <link rel="stylesheet" href="estilos/estilos.css">
</head>
<body>

<div id="loading-overlay">
    <div class="loading-box">
        <img src="/favicon.png" class="loading-logo" alt="Cargando...">
    </div>
</div>

<div class="main-container">

    <div id="seccionLogin">
         <div class="login-container">
            <h1><i class="fas fa-gift"></i> Iniciar Sesión</h1>
            <form id="formularioLogin">
                <div>
                    <label for="email">Correo Electrónico:</label>
                    <input type="email" id="email" required placeholder="tu.correo@ejemplo.com">
                </div>
                <div>
                    <label for="password">Contraseña:</label>
                    <input type="password" id="password" required placeholder="••••••••">
                </div>
                 <div id="mensajeError"></div>
                <button type="submit"><i class="fas fa-sign-in-alt"></i> Ingresar</button>
            </form>
        </div>
    </div>

    <div id="seccionPedidos">
        <div class="titulo-contador-container">
            <h1><i class="fas fa-list-alt" style="color: var(--color-secondary);"></i> Lista de Pedidos</h1>
            <span id="contadorPedidosHoy" class="contador-pedidos" title="Pedidos registrados hoy">0</span>
            <span id="contadorPedidosFiltrados" class="contador-pedidos" title="Pedidos en la vista actual (clic 5 veces para ver suma)"></span>
            <span id="contadorSumaFiltrada" class="contador-pedidos" title="Suma de precios de los pedidos filtrados"></span>
        </div>
        <div class="user-info-container">
             <p id="usuarioLogueado"></p>
             <button id="darkModeToggle"><i class="fas fa-moon"></i> Modo Oscuro</button>
        </div>


        <div id="filtrosContainer" class="content-box">
             <h2><i class="fas fa-filter"></i> Filtros</h2>
             <div class="filtros-grid">
                 <div class="filtro-item">
                    <label for="filtroProducto"><i class="fas fa-tag"></i> Por producto:</label>
                    <select id="filtroProducto">
                        <option value="">Todos los productos</option>
                    </select>
                 </div>
                  <div class="filtro-item">
                     <label for="filtroFecha"><i class="fas fa-calendar-day"></i> Por fecha:</label>
                     <select id="filtroFecha">
                         <option value="">Cualquier fecha</option>
                         <option value="ultimos-10-dias">Últimos 10 días</option>
                         <option value="hoy">Hoy</option>
                         <option value="ayer">Ayer</option>
                         <option value="este-mes">Este mes</option>
                         <option value="personalizado">Personalizado</option>
                     </select>
                  </div>
                  <div class="filtro-item">
                    <label for="filtroEstatus"><i class="fas fa-check-circle"></i> Por estatus:</label>
                    <select id="filtroEstatus">
                        <option value="">Todos los estatus</option>
                        </select>
                 </div>
                 <div id="rangoFechaPersonalizado" class="filtro-item">
                    <label for="filtroFechaPersonalizada"><i class="fas fa-calendar-alt"></i> Fecha o Rango:</label>
                    <input type="text" id="filtroFechaPersonalizada" placeholder="Selecciona una fecha o un rango">
                 </div>

                 <div class="filtro-item" style="grid-column: span 2; display: flex; gap: 10px;">
                    <button id="btnAplicarFiltros"><i class="fas fa-filter"></i> Aplicar Filtros</button>
                    <button id="btnBorrarFiltros"><i class="fas fa-eraser"></i> Borrar Filtros</button>
                 </div>

             </div>
        </div>

        <button id="btnMostrarFormularioPedido"><i class="fas fa-plus-circle"></i> Registrar Nuevo Pedido</button>
        <div id="mensajeConfirmacion"></div>
        <div class="tabla-container-wrapper content-box">
              <div class="tabla-container">
                  <table id="tablaPedidos">
                      <thead>
                          <tr>
                              <th># Pedido</th>
                              <th>Fecha y Hora</th>
                              <th>Vendedor</th>
                              <th>Teléfono</th>
                              <th>Estatus</th>
                              <th>Comentarios</th>
                              <th>Producto</th>
                              <th>Datos Producto</th>
                              <th>Promoción</th>
                              <th>Precio</th>
                              <th>Acciones</th>
                          </tr>
                      </thead>
                      <tbody id="cuerpoTablaPedidos">
                          <tr>
                              <td colspan="11" class="loading-cell"><i class="fas fa-spinner fa-spin"></i> Cargando pedidos lindos...</td>
                          </tr>
                      </tbody>
                  </table>
              </div>
              <button id="scrollToTopBtn" title="Ir arriba"><i class="fas fa-arrow-up"></i></button>
         </div>

        <button id="btnCerrarSesion"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</button>
    </div>

</div>

<div id="modalNuevoPedido" class="modal-overlay" style="display: none;">
    <div class="modal-content" id="modalContentNuevoPedido">
        <button id="btnCerrarModal" class="modal-close-btn" title="Cerrar">×</button>
        <div id="nuevoPedidoContainer">
             <h2 id="modalTitle"><i class="fas fa-pencil-alt"></i> Registrar Nuevo Pedido</h2>
             <form id="formularioNuevoPedido">
                 <div class="form-grid">
                     <div class="form-item">
                         <label for="pedidoProductoSelect">Producto (*):</label>
                         <select id="pedidoProductoSelect" required>
                            <option value="Modelo 7">Modelo 7</option>
                            <option value="Portallaves">Portallaves</option>
                            <option value="Calendario">Calendario</option>
                            <option value="Placa de perro">Placa de perro</option>
                            <option value="Otro">Otro</option>
                         </select>
                         <input type="text" id="pedidoProductoOtro" style="display: none;" placeholder="Nombre del producto">
                     </div>
                     <div class="form-item">
                         <label for="pedidoTelefono">Teléfono (*):</label>
                         <input type="tel" id="pedidoTelefono" placeholder="Ej: 5512345678" required>
                     </div>
                     <div class="form-item">
                          <label for="pedidoPrecio">Precio (MXN):</label>
                          <input type="number" id="pedidoPrecio" step="0.01" placeholder="Ej: 275.00">
                      </div>

                      <div class="form-item form-item-full">
                           <label for="pedidoFotoFile">Fotos del Pedido (Clic derecho o Ctrl+C para copiar):</label>
                           <div class="file-input-container" id="fileInputContainerProducto" tabindex="0">
                               <input type="file" id="pedidoFotoFile" accept="image/*" multiple>
                               <div class="file-input-header">
                                   <label for="pedidoFotoFile" class="custom-file-upload">
                                       <i class="fas fa-upload"></i> Seleccionar
                                   </label>
                                   <span>O arrastra y suelta imágenes aquí</span>
                               </div>
                               <div class="previews-container" id="fotosPreviewContainer">
                                   </div>
                           </div>
                      </div>
                     <div class="form-item form-item-full">
                         <label for="pedidoDatosProducto">Detalles del Producto:</label>
                         <textarea id="pedidoDatosProducto" placeholder="Describe los detalles específicos del producto solicitado..."></textarea>
                     </div>

                     <div class="form-item form-item-full">
                        <label for="pedidoFotoPromocionFile">Fotos de la Promoción (Clic derecho o Ctrl+C para copiar):</label>
                        
                        <!-- NEW CHECKBOX CONTAINER -->
                        <div class="checkbox-container" id="mismaFotoContainer" style="display: none;">
                            <input type="checkbox" id="mismaFotoCheckbox">
                            <label for="mismaFotoCheckbox">Usar la(s) misma(s) foto(s) del pedido</label>
                        </div>
                        
                        <div class="file-input-container" id="fileInputContainerPromocion" tabindex="0">
                            <input type="file" id="pedidoFotoPromocionFile" accept="image/*" multiple>
                            <div class="file-input-header">
                                <label for="pedidoFotoPromocionFile" class="custom-file-upload">
                                    <i class="fas fa-upload"></i> Seleccionar
                                </label>
                                <span>O arrastra y suelta imágenes aquí</span>
                            </div>
                            <div class="previews-container" id="promoFotosPreviewContainer">
                                </div>
                        </div>
                    </div>
                    <div class="form-item form-item-full">
                        <label for="pedidoDatosPromocion">Detalles de la Promoción:</label>
                        <textarea id="pedidoDatosPromocion" placeholder="Describe la promoción aplicada, si existe..."></textarea>
                    </div>

                    <div class="form-item form-item-full">
                           <label for="pedidoComentarios">Comentarios Adicionales:</label>
                           <textarea id="pedidoComentarios" placeholder="Añade cualquier otra nota relevante sobre el pedido..."></textarea>
                    </div>
                 </div>
                 <div id="mensajeErrorPedido"></div>
                 <div class="form-actions">
                      <button type="button" id="btnCancelarPedido"><i class="fas fa-times"></i> Cancelar</button>
                      <button type="submit" id="btnGuardarPedido"><i class="fas fa-save"></i> Guardar Pedido</button>
                 </div>
             </form>
        </div>
    </div>
</div>

<div id="modalImagenPedido" class="modal-overlay" style="display: none;">
    <div class="modal-content-image">
        <button id="btnCerrarModalImagen" class="modal-close-btn" title="Cerrar">×</button>
        <div id="modalImagenPedidoId" class="modal-image-order-id"></div>
        <div class="modal-image-header">
            <button id="modalImagenPrevBtn" class="modal-image-nav-btn" title="Anterior"><i class="fas fa-chevron-left"></i></button>
            <span id="modalImagenPedidoCounter">1 / 1</span>
            <button id="modalImagenNextBtn" class="modal-image-nav-btn" title="Siguiente"><i class="fas fa-chevron-right"></i></button>
        </div>
        <img id="imagenModal" class="modal-image" src="" alt="Foto del Pedido">
        <div id="modalThumbnailContainer" class="modal-thumbnail-container"></div>
    </div>
</div>

<div id="modalConfirmarBorrado" class="modal-overlay" style="display: none;">
    <div class="modal-confirm-content">
        <button id="btnCerrarModalConfirmarBorrado" class="modal-close-btn" title="Cerrar">×</button>
        <h3><i class="fas fa-exclamation-triangle" style="color: var(--color-danger);"></i> Confirmar Borrado</h3>
        <p id="textoConfirmarBorrado">¿Estás seguro de que quieres borrar este pedido? Esta acción no se puede deshacer.</p>
        <div id="mensajeErrorConfirmacion"></div>
        <div class="modal-confirm-actions">
            <button type="button" id="btnCancelarBorrado" class="modal-confirm-cancel"><i class="fas fa-times"></i> Cancelar</button>
            <button type="button" id="btnConfirmarBorradoDefinitivo" class="modal-confirm-delete"><i class="fas fa-trash-alt"></i> Sí, Borrar</button>
        </div>
    </div>
</div>

<div id="modalConfirmacionRegistro" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <h3><i class="fas fa-check-circle"></i> Pedido Registrado Correctamente</h3>
        <div>
            <span id="numeroPedidoConfirmacion"></span>
            <button id="btnCopiarNumeroPedidoConfirmacion" title="Copiar número de pedido"><i class="fas fa-copy"></i></button>
        </div>
        <div class="form-actions">
            <button type="button" id="btnCerrarModalConfirmacionRegistro"><i class="fas fa-times"></i> Cerrar</button>
        </div>
    </div>
</div>

<div id="modalComentario" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <button id="btnCerrarModalComentarioTop" class="modal-close-btn" title="Cerrar">×</button>
        <h3><i class="fas fa-comment-dots" style="color: var(--color-secondary);"></i> Comentario Completo</h3>
        <p id="textoComentarioCompleto"></p>
         <div class="form-actions">
            <button type="button" id="btnCerrarModalComentarioBottom" class="modal-confirm-cancel"><i class="fas fa-times"></i> Cerrar</button>
        </div>
    </div>
</div>

<div id="copy-toast">¡Texto copiado!</div>
<div id="photo-copy-toast">¡Foto copiada!</div>

<div id="page-overlay"></div>
<div id="search-bar-container" style="display: none;">
    <span id="search-match-icon"></span>
    <input type="text" id="searchInput" placeholder="Buscar en pedidos...">
    <span id="search-counter">0/0</span>
    <div id="search-nav-buttons">
        <button id="prevMatchBtn" title="Anterior (Shift+Enter)"><i class="fas fa-chevron-up"></i></button>
        <button id="nextMatchBtn" title="Siguiente (Enter)"><i class="fas fa-chevron-down"></i></button>
    </div>
    <button id="closeSearchBtn" title="Cerrar (Esc)">&times;</button>
</div>

<!-- Link to external JS file -->
<script type="module" src="js/logica.js"></script>

</body>
</html>
